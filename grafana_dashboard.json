{
  "__inputs": [
    {
      "name": "DS_QUESTDB",
      "label": "QuestDB",
      "description": "",
      "type": "datasource",
      "pluginId": "questdb-questdb-datasource",
      "pluginName": "QuestDB"
    }
  ],
  "__elements": {},
  "__requires": [
    {
      "type": "panel",
      "id": "ae3e-plotly-panel",
      "name": "Plotly panel",
      "version": "0.5.0"
    },
    {
      "type": "panel",
      "id": "candlestick",
      "name": "Candlestick",
      "version": ""
    },
    {
      "type": "grafana",
      "id": "grafana",
      "name": "Grafana",
      "version": "10.4.1"
    },
    {
      "type": "datasource",
      "id": "questdb-questdb-datasource",
      "name": "QuestDB",
      "version": "0.1.5"
    },
    {
      "type": "panel",
      "id": "table",
      "name": "Table",
      "version": ""
    },
    {
      "type": "panel",
      "id": "timeseries",
      "name": "Time series",
      "version": ""
    }
  ],
  "annotations": {
    "list": [
      {
        "builtIn": 1,
        "datasource": {
          "type": "grafana",
          "uid": "-- Grafana --"
        },
        "enable": true,
        "hide": true,
        "iconColor": "rgba(0, 211, 255, 1)",
        "name": "Annotations & Alerts",
        "type": "dashboard"
      }
    ]
  },
  "description": "FX Orderbook Realtime Demo with Arrays",
  "editable": true,
  "fiscalYearStartMonth": 0,
  "graphTooltip": 0,
  "id": null,
  "links": [],
  "panels": [
    {
      "datasource": {
        "type": "questdb-questdb-datasource",
        "uid": "${DS_QUESTDB}"
      },
      "description": "Visualizes the order book snapshot for the selected currency pair, showing the price and cumulative volume at each bid and ask level. The area under the green (bids) and red (asks) lines represents market liquidity on both sides, with the mid-price and top volume “walls” highlighted for quick identification of major support and resistance.",
      "gridPos": {
        "h": 10,
        "w": 12,
        "x": 0,
        "y": 0
      },
      "hideTimeOverride": true,
      "id": 27,
      "maxPerRow": 2,
      "options": {
        "onclick": "console.log(data)\nwindow.updateVariables({query:{'var-project':'test'}, partial: true})",
        "script": "const table = data.series[0];\nconst fields = table.fields;\n\nconst side = fields.find(f => f.name === \"side\");\nconst price = fields.find(f => f.name === \"price\");\nconst cum_volume = fields.find(f => f.name === \"cum_volume\");\nconst volume = fields.find(f => f.name === \"volume\");\n\nif (!side || !price || !cum_volume || !volume) {\n  throw new Error(\"Missing required fields\");\n}\n\nconst sideVals = side.values.toArray();\nconst priceVals = price.values.toArray();\nconst cumVolVals = cum_volume.values.toArray();\nconst volVals = volume.values.toArray();\n\nconst bids = [];\nconst asks = [];\n\nfor (let i = 0; i < priceVals.length; i++) {\n  const s = sideVals[i];\n  const p = priceVals[i];\n  const v = cumVolVals[i];\n  const raw = volVals[i];\n\n  if (s === \"bid\") bids.push({ x: p, y: v, raw });\n  else if (s === \"ask\") asks.push({ x: p, y: v, raw });\n}\n\nbids.sort((a, b) => b.x - a.x);\nasks.sort((a, b) => a.x - b.x);\n\nconst bestBid = bids[0]?.x ?? 0;\nconst bestAsk = asks[0]?.x ?? 0;\nconst mid = (bestBid + bestAsk) / 2;\n\nif (bids.length > 0) bids.unshift({ x: mid, y: bids[0].y });\nif (asks.length > 0) asks.unshift({ x: mid, y: 0 });\n\nconst topBids = [...bids]\n  .filter(b => b.raw)\n  .sort((a, b) => b.raw - a.raw)\n  .slice(-2); // largest 2\n\nconst topAsks = [...asks]\n  .filter(a => a.raw)\n  .sort((a, b) => b.raw - a.raw)\n  .slice(-2); // largest 2\n\nconst wallLines = [...topBids, ...topAsks].map(wall => ({\n  type: \"line\",\n  x0: wall.x,\n  x1: wall.x,\n  y0: 0,\n  y1: 1,\n  xref: \"x\",\n  yref: \"paper\",\n  line: {\n    color: \"yellow\",\n    width: 1,\n    dash: \"dot\"\n  }\n}));\n\nconst wallLabels = [...topBids, ...topAsks].map(wall => ({\n  x: wall.x,\n  y: 1.02,\n  xref: \"x\",\n  yref: \"paper\",\n  text: wall.x.toFixed(5),\n  showarrow: false,\n  font: { color: \"yellow\", size: 10 }\n}));\n\nreturn {\n  data: [\n    {\n      name: \"Bids\",\n      x: bids.map(pt => pt.x),\n      y: bids.map(pt => pt.y),\n      mode: \"lines\",\n      fill: \"tozeroy\",\n      fillcolor: \"rgba(0,255,0,0.2)\",\n      line: { shape: \"hv\", color: \"rgba(0,255,0,0.7)\", width: 2 },\n      type: \"scatter\",\n      hovertemplate: \"Price: %{x}<br>CumVol: %{y}<extra></extra>\"\n    },\n    {\n      name: \"Asks\",\n      x: asks.map(pt => pt.x),\n      y: asks.map(pt => pt.y),\n      mode: \"lines\",\n      fill: \"tozeroy\",\n      fillcolor: \"rgba(255,0,0,0.2)\",\n      line: { shape: \"hv\", color: \"rgba(255,0,0,0.7)\", width: 2 },\n      type: \"scatter\",\n      hovertemplate: \"Price: %{x}<br>CumVol: %{y}<extra></extra>\"\n    }\n  ],\n  layout: {\n    plot_bgcolor: \"black\",\n    paper_bgcolor: \"black\",\n    font: { color: \"white\" },\n    xaxis: {\n      title: \"Price\",\n      type: \"linear\",\n      showgrid: true,\n      gridcolor: \"rgba(255,255,255,0.1)\",\n      zeroline: false\n    },\n    yaxis: {\n      title: \"Cumulative Volume\",\n      showgrid: true,\n      gridcolor: \"rgba(255,255,255,0.1)\",\n      zeroline: false\n    },\n    margin: { t: 40, l: 60, r: 20, b: 50 },\n    shapes: [\n      {\n        type: \"line\",\n        x0: mid,\n        x1: mid,\n        y0: 0,\n        y1: 1,\n        xref: \"x\",\n        yref: \"paper\",\n        line: {\n          color: \"white\",\n          width: 1,\n          dash: \"dot\"\n        }\n      },\n      ...wallLines\n    ],\n    annotations: wallLabels,\n    legend: {\n      orientation: \"h\",\n      x: 0.5,\n      xanchor: \"center\",\n      y: -0.3\n    }\n  }\n};"
      },
      "pluginVersion": "0.5.0",
      "repeat": "SYMBOL",
      "repeatDirection": "h",
      "targets": [
        {
          "datasource": {
            "type": "questdb-questdb-datasource",
            "uid": "${DS_QUESTDB}"
          },
          "format": 1,
          "meta": {
            "builderOptions": {
              "fields": [],
              "limit": "",
              "mode": "list",
              "timeField": ""
            }
          },
          "queryType": "sql",
          "rawSql": "WITH snapshot AS (\n  SELECT timestamp, bids, asks\n  FROM market_data\n  WHERE $__timeFilter(timestamp) and  symbol = '${SYMBOL}'\n  ORDER BY timestamp DESC\n  LIMIT 1\n),\nbid_levels AS (\n  SELECT timestamp, 'bid' AS side, bids[1,1] AS price, bids[2,1] AS volume FROM snapshot\n  UNION ALL SELECT timestamp, 'bid', bids[1,2], bids[2,2] FROM snapshot\n  UNION ALL SELECT timestamp, 'bid', bids[1,3], bids[2,3] FROM snapshot\n  UNION ALL SELECT timestamp, 'bid', bids[1,4], bids[2,4] FROM snapshot\n  UNION ALL SELECT timestamp, 'bid', bids[1,5], bids[2,5] FROM snapshot\n  UNION ALL SELECT timestamp, 'bid', bids[1,6], bids[2,6] FROM snapshot\n  UNION ALL SELECT timestamp, 'bid', bids[1,7], bids[2,7] FROM snapshot\n),\nask_levels AS (\n  SELECT timestamp, 'ask' AS side, asks[1,1] AS price, asks[2,1] AS volume FROM snapshot\n  UNION ALL SELECT timestamp, 'ask', asks[1,2], asks[2,2] FROM snapshot\n  UNION ALL SELECT timestamp, 'ask', asks[1,3], asks[2,3] FROM snapshot\n  UNION ALL SELECT timestamp, 'ask', asks[1,4], asks[2,4] FROM snapshot\n  UNION ALL SELECT timestamp, 'ask', asks[1,5], asks[2,5] FROM snapshot\n  UNION ALL SELECT timestamp, 'ask', asks[1,6], asks[2,6] FROM snapshot\n  UNION ALL SELECT timestamp, 'ask', asks[1,7], asks[2,7] FROM snapshot\n),\nbid_cum AS (\n  SELECT\n    timestamp,\n    side,\n    price,\n    volume,\n    SUM(volume) OVER (ORDER BY price DESC) AS cum_volume\n  FROM bid_levels\n  WHERE price IS NOT NULL\n),\nask_cum AS (\n  SELECT\n    timestamp,\n    side,\n    price,\n    volume,\n    SUM(volume) OVER (ORDER BY price ASC) AS cum_volume\n  FROM ask_levels\n  WHERE price IS NOT NULL\n)\nSELECT * FROM bid_cum\nUNION ALL\nSELECT * FROM ask_cum\nORDER BY side, price;\n",
          "refId": "A",
          "selectedFormat": 2
        }
      ],
      "timeFrom": "10m",
      "title": "Market Depth - ${SYMBOL}",
      "type": "ae3e-plotly-panel"
    },
    {
      "collapsed": false,
      "gridPos": {
        "h": 1,
        "w": 24,
        "x": 0,
        "y": 10
      },
      "id": 21,
      "panels": [],
      "repeat": "SYMBOL",
      "title": "Prices and Spread",
      "type": "row"
    },
    {
      "datasource": {
        "type": "questdb-questdb-datasource",
        "uid": "${DS_QUESTDB}"
      },
      "description": "Displays a rolling table of the most recent seconds for the selected currency pair, summarizing the current average spread (difference between best ask and best bid) along with the aggregated bid and ask volumes. Use this to monitor how liquidity and price tightness evolve in real time, and spot sudden widening or bursts in traded volume.",
      "fieldConfig": {
        "defaults": {
          "color": {
            "fixedColor": "semi-dark-blue",
            "mode": "shades"
          },
          "custom": {
            "align": "auto",
            "cellOptions": {
              "type": "color-background"
            },
            "inspect": false,
            "minWidth": 50
          },
          "fieldMinMax": false,
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              },
              {
                "color": "#6ED0E0",
                "value": 11000000
              },
              {
                "color": "#EAB839",
                "value": 13000000
              },
              {
                "color": "red",
                "value": 14000000
              }
            ]
          }
        },
        "overrides": [
          {
            "matcher": {
              "id": "byName",
              "options": "Time"
            },
            "properties": [
              {
                "id": "custom.minWidth",
                "value": 200
              },
              {
                "id": "color",
                "value": {
                  "fixedColor": "#692f894d",
                  "mode": "fixed"
                }
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "Spread"
            },
            "properties": [
              {
                "id": "color",
                "value": {
                  "fixedColor": "#692f8980",
                  "mode": "fixed"
                }
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "Bid_Volume"
            },
            "properties": [
              {
                "id": "color",
                "value": {
                  "fixedColor": "#692f89bf",
                  "mode": "fixed"
                }
              },
              {
                "id": "unit",
                "value": "short"
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "Ask_Volume"
            },
            "properties": [
              {
                "id": "color",
                "value": {
                  "fixedColor": "#692f89",
                  "mode": "fixed"
                }
              },
              {
                "id": "unit",
                "value": "short"
              }
            ]
          }
        ]
      },
      "gridPos": {
        "h": 8,
        "w": 7,
        "x": 0,
        "y": 11
      },
      "hideTimeOverride": true,
      "id": 20,
      "options": {
        "cellHeight": "sm",
        "footer": {
          "countRows": false,
          "enablePagination": false,
          "fields": "",
          "reducer": [
            "sum"
          ],
          "show": false
        },
        "showHeader": true
      },
      "pluginVersion": "10.4.1",
      "targets": [
        {
          "datasource": {
            "type": "questdb-questdb-datasource",
            "uid": "${DS_QUESTDB}"
          },
          "editorMode": "code",
          "format": 1,
          "rawQuery": true,
          "rawSql": "SELECT\n  timestamp AS Time,\n  avg(asks [ 1, 1 ] - bids [ 1, 1 ]) AS Spread,\n  sum(bids [ 1, 1 ] * bids [ 2, 1 ]) AS Bid_Volume,\n  sum(asks [ 1, 1 ] * asks [ 2, 1 ]) AS Ask_Volume\nFROM market_data\nWHERE $__timeFilter(timestamp) AND symbol = '${SYMBOL}'\nSAMPLE BY 1s\nORDER BY timestamp DESC\nLIMIT 6;",
          "refId": "A",
          "selectedFormat": 2,
          "sql": {
            "columns": [
              {
                "parameters": [],
                "type": "function"
              }
            ],
            "groupBy": [
              {
                "property": {
                  "type": "string"
                },
                "type": "groupBy"
              }
            ],
            "limit": 50
          }
        }
      ],
      "timeFrom": "1m",
      "title": "Spread and Volume per second - ${SYMBOL} ",
      "transparent": true,
      "type": "table"
    },
    {
      "datasource": {
        "type": "questdb-questdb-datasource",
        "uid": "${DS_QUESTDB}"
      },
      "description": "Compares the best bid in the order book (from L2 market data) using an ASOF JOIN against the corresponding “core” quote price from upstream sources (e.g., ECNs). Then it finds at which level we could trade the core price bid volume. If no matching level is found, Level and Price will be empty. This table helps detect price alignment issues, latency, or anomalies between your live order book and reference prices provided by liquidity venues.",
      "fieldConfig": {
        "defaults": {
          "color": {
            "fixedColor": "light-blue",
            "mode": "shades"
          },
          "custom": {
            "align": "auto",
            "cellOptions": {
              "type": "color-background"
            },
            "inspect": false,
            "minWidth": 50,
            "width": 99
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              },
              {
                "color": "red",
                "value": 80
              }
            ]
          }
        },
        "overrides": [
          {
            "matcher": {
              "id": "byName",
              "options": "MarketData_Time"
            },
            "properties": [
              {
                "id": "custom.minWidth",
                "value": 200
              },
              {
                "id": "custom.width",
                "value": 180
              },
              {
                "id": "color",
                "value": {
                  "fixedColor": "#692f894d",
                  "mode": "fixed"
                }
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "CorePrice_Time"
            },
            "properties": [
              {
                "id": "custom.minWidth",
                "value": 200
              },
              {
                "id": "custom.width"
              },
              {
                "id": "color",
                "value": {
                  "fixedColor": "#692f894d",
                  "mode": "fixed"
                }
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "Level"
            },
            "properties": [
              {
                "id": "custom.width",
                "value": 20
              },
              {
                "id": "color",
                "value": {
                  "fixedColor": "#692f8980",
                  "mode": "fixed"
                }
              },
              {
                "id": "noValue",
                "value": "-"
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "Price"
            },
            "properties": [
              {
                "id": "custom.width"
              },
              {
                "id": "color",
                "value": {
                  "fixedColor": "#692f89bf",
                  "mode": "fixed"
                }
              },
              {
                "id": "noValue",
                "value": "-"
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "Bid_Price"
            },
            "properties": [
              {
                "id": "custom.width"
              },
              {
                "id": "color",
                "value": {
                  "fixedColor": "#692f8980",
                  "mode": "fixed"
                }
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "Volume"
            },
            "properties": [
              {
                "id": "color",
                "value": {
                  "fixedColor": "#692f89",
                  "mode": "fixed"
                }
              },
              {
                "id": "unit",
                "value": "short"
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "Bid_Volume"
            },
            "properties": [
              {
                "id": "color",
                "value": {
                  "fixedColor": "#692f89bf",
                  "mode": "fixed"
                }
              },
              {
                "id": "unit",
                "value": "short"
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "ECN"
            },
            "properties": [
              {
                "id": "color",
                "value": {
                  "fixedColor": "#692f89",
                  "mode": "fixed"
                }
              }
            ]
          }
        ]
      },
      "gridPos": {
        "h": 8,
        "w": 9,
        "x": 7,
        "y": 11
      },
      "hideTimeOverride": true,
      "id": 19,
      "options": {
        "cellHeight": "sm",
        "footer": {
          "countRows": false,
          "fields": "",
          "reducer": [
            "sum"
          ],
          "show": false
        },
        "showHeader": true
      },
      "pluginVersion": "10.4.1",
      "targets": [
        {
          "datasource": {
            "type": "questdb-questdb-datasource",
            "uid": "${DS_QUESTDB}"
          },
          "format": 1,
          "meta": {
            "builderOptions": {
              "fields": [],
              "limit": "",
              "mode": "list",
              "timeField": ""
            }
          },
          "queryType": "sql",
          "rawSql": "WITH p AS (\n  SELECT\n    timestamp,\n    bid_price,\n    bid_volume,\n    symbol,\n    ecn\n  FROM core_price\n  WHERE $__timeFilter(timestamp) AND symbol = '${SYMBOL}'\n  LIMIT -6\n), levels AS (\n  SELECT\n    market_data.timestamp AS md_timestamp,\n    insertion_point(bids [ 2 ], bid_volume) AS level,\n    bids [ 1 ] [ insertion_point(bids [ 2 ], bid_volume) ] AS price,\n    bids [ 2 ] [ insertion_point(bids [ 2 ], bid_volume) ] AS volume,\n    p.timestamp,\n    p.bid_price,\n    p.bid_volume AS bid_volume,\n    p.ecn\n  FROM p ASOF JOIN market_data ON symbol\n)\nSELECT\n  md_timestamp AS MarketData_Time,\n  CASE WHEN price IS null THEN null ELSE level end AS Level,\n  Price,\n  Volume,\n  timestamp AS CorePrice_Time,\n  bid_price AS Bid_Price,\n  bid_volume1 AS Bid_Volume,\n  ecn AS ECN\nFROM levels;",
          "refId": "A",
          "selectedFormat": 1
        }
      ],
      "timeFrom": "1m",
      "title": "Top-of-book Levels vs Core Price - ${SYMBOL}",
      "transparent": true,
      "type": "table"
    },
    {
      "datasource": {
        "type": "questdb-questdb-datasource",
        "uid": "${DS_QUESTDB}"
      },
      "description": "Candlestick chart summarizing price action using the best bid from the order book, aggregated into 5-second intervals. Each candlestick shows the open, high, low, and close bid price, along with traded volume. Ideal for visualizing price trends, volatility, and market regime changes over time. Data is queried from a live table and aggregated on the fly.",
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "palette-classic"
          },
          "custom": {
            "axisBorderShow": false,
            "axisCenteredZero": false,
            "axisColorMode": "text",
            "axisLabel": "",
            "axisPlacement": "auto",
            "barAlignment": 0,
            "drawStyle": "line",
            "fillOpacity": 0,
            "gradientMode": "none",
            "hideFrom": {
              "legend": false,
              "tooltip": false,
              "viz": false
            },
            "insertNulls": false,
            "lineInterpolation": "linear",
            "lineStyle": {
              "fill": "solid"
            },
            "lineWidth": 1,
            "pointSize": 3,
            "scaleDistribution": {
              "type": "linear"
            },
            "showPoints": "auto",
            "spanNulls": false,
            "stacking": {
              "group": "A",
              "mode": "none"
            },
            "thresholdsStyle": {
              "mode": "off"
            }
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              },
              {
                "color": "red",
                "value": 80
              }
            ]
          }
        },
        "overrides": []
      },
      "gridPos": {
        "h": 8,
        "w": 8,
        "x": 16,
        "y": 11
      },
      "id": 13,
      "options": {
        "candleStyle": "candles",
        "colorStrategy": "open-close",
        "colors": {
          "down": "light-blue",
          "up": "semi-dark-purple"
        },
        "fields": {
          "close": "close",
          "high": "high",
          "low": "low",
          "open": "open",
          "volume": "total_volume"
        },
        "includeAllFields": false,
        "legend": {
          "calcs": [
            "last"
          ],
          "displayMode": "table",
          "placement": "bottom",
          "showLegend": false
        },
        "mode": "candles+volume",
        "tooltip": {
          "hideZeros": false,
          "mode": "multi",
          "sort": "none"
        }
      },
      "pluginVersion": "11.6.0",
      "targets": [
        {
          "datasource": {
            "type": "questdb-questdb-datasource",
            "uid": "${DS_QUESTDB}"
          },
          "editorMode": "code",
          "format": 1,
          "queryType": "sql",
          "rawQuery": true,
          "rawSql": "select\n    timestamp,\n    first(bids[1,1]) open,\n    max(bids[1,1]) high,\n    min(bids[1,1]) low, \n    last(bids[1,1]) close,\n    sum(bids[2,1]) total_volume\nfrom market_data\nwhere  $__timeFilter(timestamp) and symbol = '${SYMBOL}'\nsample by 5s;",
          "refId": "A",
          "selectedFormat": 2,
          "sql": {
            "columns": [
              {
                "parameters": [],
                "type": "function"
              }
            ],
            "groupBy": [
              {
                "property": {
                  "type": "string"
                },
                "type": "groupBy"
              }
            ],
            "limit": 50
          }
        }
      ],
      "timeFrom": "5m",
      "title": "OHLC - Bids - 5secs - (${SYMBOL})",
      "transparent": true,
      "type": "candlestick"
    },
    {
      "collapsed": false,
      "gridPos": {
        "h": 1,
        "w": 24,
        "x": 0,
        "y": 28
      },
      "id": 23,
      "panels": [],
      "repeat": "SYMBOL",
      "title": "Indicators",
      "type": "row"
    },
    {
      "datasource": {
        "type": "questdb-questdb-datasource",
        "uid": "${DS_QUESTDB}"
      },
      "description": "Multi-layered chart, overlaid on OHLC candles, combining three technical indicators for the selected symbol:\n\t•\tVWAP: Shows the Volume-Weighted Average Price, a key benchmark for execution quality.\n\t•\tRSI (12h): The Relative Strength Index, computed over 12-hour rolling windows, highlights overbought/oversold conditions and price momentum.\n\t•\tBollinger Bands (20,2): Plots a 20-period moving average with ±2 standard deviations, indicating price volatility and potential breakout/reversal zones. Each period is 15 minutes, so the simple moving average (SMA) covers a 6-hour window.",
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "palette-classic"
          },
          "custom": {
            "axisBorderShow": false,
            "axisCenteredZero": false,
            "axisColorMode": "text",
            "axisLabel": "",
            "axisPlacement": "auto",
            "barAlignment": 0,
            "drawStyle": "line",
            "fillOpacity": 0,
            "gradientMode": "none",
            "hideFrom": {
              "legend": false,
              "tooltip": false,
              "viz": false
            },
            "insertNulls": false,
            "lineInterpolation": "linear",
            "lineWidth": 1,
            "pointSize": 5,
            "scaleDistribution": {
              "type": "linear"
            },
            "showPoints": "auto",
            "spanNulls": false,
            "stacking": {
              "group": "A",
              "mode": "none"
            },
            "thresholdsStyle": {
              "mode": "off"
            }
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              },
              {
                "color": "red",
                "value": 80
              }
            ]
          }
        },
        "overrides": [
          {
            "matcher": {
              "id": "byFrameRefID",
              "options": "RSI"
            },
            "properties": [
              {
                "id": "unit",
                "value": "RSI %"
              },
              {
                "id": "custom.axisPlacement",
                "value": "auto"
              },
              {
                "id": "custom.axisSoftMax",
                "value": 100
              }
            ]
          },
          {
            "matcher": {
              "id": "byFrameRefID",
              "options": "Bollinger"
            },
            "properties": [
              {
                "id": "color",
                "value": {
                  "fixedColor": "light-blue",
                  "mode": "palette-classic-by-name"
                }
              },
              {
                "id": "custom.showPoints",
                "value": "always"
              }
            ]
          }
        ]
      },
      "gridPos": {
        "h": 7,
        "w": 13,
        "x": 0,
        "y": 29
      },
      "hideTimeOverride": false,
      "id": 11,
      "options": {
        "candleStyle": "candles",
        "colorStrategy": "open-close",
        "colors": {
          "down": "light-blue",
          "up": "semi-dark-purple"
        },
        "fields": {
          "close": "close",
          "high": "high",
          "low": "low",
          "open": "open",
          "volume": "total_volume"
        },
        "includeAllFields": true,
        "legend": {
          "calcs": [],
          "displayMode": "list",
          "placement": "bottom",
          "showLegend": true
        },
        "mode": "candles+volume",
        "tooltip": {
          "hideZeros": false,
          "mode": "multi",
          "sort": "none"
        }
      },
      "pluginVersion": "11.6.0",
      "targets": [
        {
          "datasource": {
            "type": "questdb-questdb-datasource",
            "uid": "${DS_QUESTDB}"
          },
          "format": 1,
          "meta": {
            "builderOptions": {
              "fields": [],
              "limit": "",
              "mode": "list",
              "timeField": ""
            }
          },
          "queryType": "sql",
          "rawSql": "WITH sampled AS (\n    SELECT\n          timestamp,  symbol,\n          total_volume,\n          ((open+close)/2) * total_volume AS traded_value\n     FROM market_data_ohlc_1m\n     WHERE $__timeFilter(timestamp)\n      AND \n      symbol IN '${SYMBOL}'     \n), cumulative AS (\n     SELECT timestamp, symbol,\n           SUM(traded_value)\n                OVER (ORDER BY timestamp) AS cumulative_value,\n           SUM(total_volume)\n                OVER (ORDER BY timestamp) AS cumulative_volume\n     FROM sampled\n), vwap as (\nSELECT timestamp, cumulative_value/cumulative_volume AS vwap FROM cumulative\n)    \nSELECT * FROM vwap",
          "refId": "VWAP",
          "selectedFormat": 2
        },
        {
          "datasource": {
            "type": "questdb-questdb-datasource",
            "uid": "${DS_QUESTDB}"
          },
          "format": 1,
          "hide": false,
          "meta": {
            "builderOptions": {
              "fields": [],
              "limit": "",
              "mode": "list",
              "timeField": ""
            }
          },
          "queryType": "sql",
          "rawSql": "     select timestamp, open, high, low,  close, total_volume\n        from market_data_ohlc_15m\n        where  $__timeFilter(timestamp) and symbol = '${SYMBOL}'\n",
          "refId": "OHLC",
          "selectedFormat": 2
        },
        {
          "datasource": {
            "type": "questdb-questdb-datasource",
            "uid": "${DS_QUESTDB}"
          },
          "format": 1,
          "hide": false,
          "meta": {
            "builderOptions": {
              "fields": [],
              "limit": "",
              "mode": "list",
              "timeField": ""
            }
          },
          "queryType": "sql",
          "rawSql": "WITH price_changes AS (\n    SELECT\n        timestamp,    \n        symbol,    \n        bid,\n        bid - prev_bid price_change\n    FROM (    \n      SELECT \n          timestamp,\n          symbol,\n          bid,\n          LAG(bid) OVER (PARTITION BY symbol ORDER BY timestamp) AS prev_bid\n      FROM bbo_1h\n      WHERE  $__timeFilter(timestamp)\n      AND symbol = '${SYMBOL}'\n    )  \n),\ngains_losses AS (\n    SELECT \n        timestamp,\n        symbol,\n        bid,\n        CASE WHEN price_change > 0 THEN price_change ELSE 0 END AS gain,\n        CASE WHEN price_change < 0 THEN ABS(price_change) ELSE 0 END AS loss\n    FROM price_changes\n),\n\navg_gains_losses AS (\n    SELECT \n        timestamp,\n        symbol,\n        bid,\n        AVG(gain) OVER (PARTITION BY symbol ORDER BY timestamp ROWS BETWEEN 11 PRECEDING AND CURRENT ROW) AS avg_gain,\n        AVG(loss) OVER (PARTITION BY symbol ORDER BY timestamp ROWS BETWEEN 11 PRECEDING AND CURRENT ROW) AS avg_loss\n    FROM gains_losses\n)\n\nSELECT \n    timestamp,    \n    --Bid,\n    CASE \n        WHEN avg_loss = 0 THEN 100\n        ELSE 100 - (100 / (1 + (avg_gain / NULLIF(avg_loss, 0))))\n    END AS RSI_12h\nFROM avg_gains_losses\nORDER BY timestamp;\n",
          "refId": "RSI",
          "selectedFormat": 2
        },
        {
          "datasource": {
            "type": "questdb-questdb-datasource",
            "uid": "${DS_QUESTDB}"
          },
          "format": 1,
          "hide": false,
          "meta": {
            "builderOptions": {
              "fields": [],
              "limit": "",
              "mode": "list",
              "timeField": ""
            }
          },
          "queryType": "sql",
          "rawSql": "WITH stats AS (\n  SELECT\n    timestamp,\n    close,\n    AVG(close) OVER (\n      ORDER BY timestamp\n      ROWS BETWEEN 19 PRECEDING AND CURRENT ROW\n    ) AS sma20,\n    AVG(close * close ) OVER (\n      ORDER BY timestamp\n      ROWS BETWEEN 19 PRECEDING AND CURRENT ROW \n    ) AS avg_close_sq\n  FROM market_data_ohlc_15m -- 20 periods of 15 minutes = SMA 6h\n   WHERE  $__timeFilter(timestamp)\n      AND symbol IN '${SYMBOL}'\n), bollinger AS (\nSELECT\n  timestamp,\n  sma20,\n  -- sqrt(avg_close_sq - (sma20 * sma20)) as stdev20,\n  sma20 + 2 * sqrt(avg_close_sq - (sma20 * sma20)) as upper_band,\n  sma20 - 2 * sqrt(avg_close_sq - (sma20 * sma20)) as lower_band\nFROM stats\nORDER BY timestamp )\nselect * from bollinger ",
          "refId": "Bollinger",
          "selectedFormat": 2
        }
      ],
      "timeFrom": "now/d",
      "title": "VWAP - RSI 12h - Bollinger Bands (20,2) (${SYMBOL})",
      "type": "candlestick"
    },
    {
      "datasource": {
        "type": "questdb-questdb-datasource",
        "uid": "${DS_QUESTDB}"
      },
      "description": "Time series chart comparing the aggregated bid and ask volumes over 30-second intervals, alongside the best bid and offer (BBO) price at 1-second granularity. Useful for monitoring shifts in market pressure, liquidity imbalances, and rapid changes in top-of-book pricing.",
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "palette-classic"
          },
          "custom": {
            "axisBorderShow": false,
            "axisCenteredZero": false,
            "axisColorMode": "text",
            "axisLabel": "",
            "axisPlacement": "auto",
            "barAlignment": 0,
            "drawStyle": "line",
            "fillOpacity": 0,
            "gradientMode": "none",
            "hideFrom": {
              "legend": false,
              "tooltip": false,
              "viz": false
            },
            "insertNulls": false,
            "lineInterpolation": "linear",
            "lineWidth": 1,
            "pointSize": 5,
            "scaleDistribution": {
              "type": "linear"
            },
            "showPoints": "auto",
            "spanNulls": false,
            "stacking": {
              "group": "A",
              "mode": "none"
            },
            "thresholdsStyle": {
              "mode": "off"
            }
          },
          "decimals": 4,
          "fieldMinMax": false,
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              },
              {
                "color": "red",
                "value": 80
              }
            ]
          },
          "unit": "currencyUSD"
        },
        "overrides": [
          {
            "matcher": {
              "id": "byName",
              "options": "bid"
            },
            "properties": [
              {
                "id": "color",
                "value": {
                  "fixedColor": "semi-dark-purple",
                  "mode": "fixed"
                }
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "ask"
            },
            "properties": [
              {
                "id": "color",
                "value": {
                  "fixedColor": "light-blue",
                  "mode": "fixed"
                }
              }
            ]
          },
          {
            "matcher": {
              "id": "byFrameRefID",
              "options": "Volume"
            },
            "properties": [
              {
                "id": "unit",
                "value": "short"
              }
            ]
          },
          {
            "matcher": {
              "id": "byFrameRefID",
              "options": "BBO"
            },
            "properties": [
              {
                "id": "unit",
                "value": "currencyUSD"
              },
              {
                "id": "color",
                "value": {
                  "mode": "palette-classic-by-name"
                }
              }
            ]
          }
        ]
      },
      "gridPos": {
        "h": 7,
        "w": 11,
        "x": 13,
        "y": 29
      },
      "id": 26,
      "options": {
        "legend": {
          "calcs": [],
          "displayMode": "list",
          "placement": "bottom",
          "showLegend": true
        },
        "tooltip": {
          "hideZeros": false,
          "mode": "multi",
          "sort": "none"
        }
      },
      "pluginVersion": "11.6.0",
      "targets": [
        {
          "datasource": {
            "type": "questdb-questdb-datasource",
            "uid": "${DS_QUESTDB}"
          },
          "format": 1,
          "meta": {
            "builderOptions": {
              "fields": [],
              "limit": "",
              "mode": "list",
              "timeField": ""
            }
          },
          "queryType": "sql",
          "rawSql": "SELECT\n  timestamp time,\n  symbol,\n  sum(bids [ 1, 1 ] * bids [ 2, 1 ]) AS bid,\n  -1 * sum(asks [ 1, 1 ] * asks [ 2, 1 ]) AS ask\nFROM\n  market_data\nWHERE $__timeFilter(timestamp) AND symbol IN '${SYMBOL}'\nSAMPLE BY 30s;",
          "refId": "Volume",
          "selectedFormat": 2
        },
        {
          "datasource": {
            "type": "questdb-questdb-datasource",
            "uid": "${DS_QUESTDB}"
          },
          "format": 0,
          "hide": false,
          "meta": {
            "builderOptions": {
              "fields": [],
              "limit": "",
              "mode": "list",
              "timeField": ""
            }
          },
          "queryType": "sql",
          "rawSql": "\n\nSELECT timestamp as Time,  Symbol, Bid, Ask, (bid+ask)/2 as Mid\n FROM \"bbo_1s\" \nWHERE $__timeFilter(timestamp)\nand symbol IN '${SYMBOL}'\n",
          "refId": "BBO",
          "selectedFormat": 2
        }
      ],
      "timeFrom": "30m",
      "title": "Bid vs Ask Volume  (30s) - BBO (1s) - (${SYMBOL})",
      "type": "timeseries"
    }
  ],
  "refresh": "500ms",
  "schemaVersion": 39,
  "tags": [],
  "templating": {
    "list": [
      {
        "allowCustomValue": false,
        "current": {},
        "datasource": {
          "type": "questdb-questdb-datasource",
          "uid": "${DS_QUESTDB}"
        },
        "definition": "SELECT distinct SYMBOL FROM (\nSELECT  SYMBOL FROM core_price\nwhere timestamp > dateadd('d',-4,now())\nlatest on timestamp partition by symbol\n) order by symbol;\n",
        "description": "symbol to filter by",
        "hide": 1,
        "includeAll": false,
        "label": "symbol",
        "multi": true,
        "name": "SYMBOL",
        "options": [],
        "query": "SELECT distinct SYMBOL FROM (\nSELECT  SYMBOL FROM core_price\nwhere timestamp > dateadd('d',-4,now())\nlatest on timestamp partition by symbol\n) order by symbol;\n",
        "refresh": 1,
        "regex": "",
        "skipUrlSync": false,
        "sort": 0,
        "type": "query"
      }
    ]
  },
  "time": {
    "from": "now-6h",
    "to": "now"
  },
  "timepicker": {
    "hidden": true,
    "refresh_intervals": [
      "250ms",
      "500ms",
      "750ms",
      "1s",
      "2s",
      "5s",
      "10s",
      "30s",
      "1m",
      "5m",
      "15m",
      "30m",
      "1h",
      "2h",
      "1d"
    ]
  },
  "timezone": "browser",
  "title": "FX Orderbook - Realtime Demo",
  "uid": "beriuq09sqry8e",
  "version": 28,
  "weekStart": ""
}
