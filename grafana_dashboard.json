{
  "__inputs": [
    {
      "name": "DS_QDB",
      "label": "qdb",
      "description": "",
      "type": "datasource",
      "pluginId": "questdb-questdb-datasource",
      "pluginName": "QuestDB"
    }
  ],
  "__elements": {},
  "__requires": [
    {
      "type": "panel",
      "id": "candlestick",
      "name": "Candlestick",
      "version": ""
    },
    {
      "type": "grafana",
      "id": "grafana",
      "name": "Grafana",
      "version": "11.6.0"
    },
    {
      "type": "datasource",
      "id": "questdb-questdb-datasource",
      "name": "QuestDB",
      "version": "0.1.5"
    },
    {
      "type": "panel",
      "id": "table",
      "name": "Table",
      "version": ""
    },
    {
      "type": "panel",
      "id": "timeseries",
      "name": "Time series",
      "version": ""
    }
  ],
  "annotations": {
    "list": [
      {
        "builtIn": 1,
        "datasource": {
          "type": "grafana",
          "uid": "-- Grafana --"
        },
        "enable": true,
        "hide": true,
        "iconColor": "rgba(0, 211, 255, 1)",
        "name": "Annotations & Alerts",
        "type": "dashboard"
      }
    ]
  },
  "description": "FX Orderbook Demo with Arrays",
  "editable": true,
  "fiscalYearStartMonth": 0,
  "graphTooltip": 0,
  "id": null,
  "links": [],
  "panels": [
    {
      "collapsed": false,
      "gridPos": {
        "h": 1,
        "w": 24,
        "x": 0,
        "y": 0
      },
      "id": 21,
      "panels": [],
      "title": "Last minute stats",
      "type": "row"
    },
    {
      "datasource": {
        "type": "questdb-questdb-datasource",
        "uid": "${DS_QDB}"
      },
      "description": "",
      "fieldConfig": {
        "defaults": {
          "color": {
            "fixedColor": "blue",
            "mode": "continuous-BlPu"
          },
          "custom": {
            "align": "auto",
            "cellOptions": {
              "type": "color-background"
            },
            "inspect": false,
            "minWidth": 50
          },
          "fieldMinMax": false,
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green"
              },
              {
                "color": "#6ED0E0",
                "value": 11000000
              },
              {
                "color": "#EAB839",
                "value": 13000000
              },
              {
                "color": "red",
                "value": 14000000
              }
            ]
          }
        },
        "overrides": [
          {
            "matcher": {
              "id": "byName",
              "options": "Time"
            },
            "properties": [
              {
                "id": "custom.cellOptions",
                "value": {
                  "type": "color-background"
                }
              },
              {
                "id": "custom.minWidth",
                "value": 200
              },
              {
                "id": "color",
                "value": {
                  "fixedColor": "semi-dark-blue",
                  "mode": "shades"
                }
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "Symbol"
            },
            "properties": [
              {
                "id": "custom.width",
                "value": 80
              }
            ]
          }
        ]
      },
      "gridPos": {
        "h": 8,
        "w": 6,
        "x": 0,
        "y": 1
      },
      "id": 7,
      "options": {
        "cellHeight": "sm",
        "footer": {
          "countRows": false,
          "enablePagination": false,
          "fields": "",
          "reducer": [
            "sum"
          ],
          "show": false
        },
        "showHeader": true
      },
      "pluginVersion": "11.6.0",
      "targets": [
        {
          "datasource": {
            "type": "questdb-questdb-datasource",
            "uid": "${DS_QDB}"
          },
          "editorMode": "code",
          "format": 1,
          "rawQuery": true,
          "rawSql": "SELECT timestamp as Time, Symbol, sum(bid_volume*bid_price) as Bid_Volume \nfrom core_price\nWHERE \n$__timeFilter(timestamp)\nSAMPLE BY 1y\nlimit 6\n--order by bid_volume desc \n--limit 10",
          "refId": "A",
          "selectedFormat": 1,
          "sql": {
            "columns": [
              {
                "parameters": [],
                "type": "function"
              }
            ],
            "groupBy": [
              {
                "property": {
                  "type": "string"
                },
                "type": "groupBy"
              }
            ],
            "limit": 50
          }
        }
      ],
      "timeShift": "1m",
      "title": "Traded Volume last minute (all currencies)",
      "type": "table"
    },
    {
      "datasource": {
        "type": "questdb-questdb-datasource",
        "uid": "${DS_QDB}"
      },
      "description": "",
      "fieldConfig": {
        "defaults": {
          "color": {
            "fixedColor": "semi-dark-blue",
            "mode": "shades"
          },
          "custom": {
            "align": "auto",
            "cellOptions": {
              "type": "color-background"
            },
            "inspect": false,
            "minWidth": 50
          },
          "fieldMinMax": false,
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green"
              },
              {
                "color": "#6ED0E0",
                "value": 11000000
              },
              {
                "color": "#EAB839",
                "value": 13000000
              },
              {
                "color": "red",
                "value": 14000000
              }
            ]
          }
        },
        "overrides": [
          {
            "matcher": {
              "id": "byName",
              "options": "Time"
            },
            "properties": [
              {
                "id": "custom.minWidth",
                "value": 200
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "Spread"
            },
            "properties": [
              {
                "id": "color",
                "value": {
                  "mode": "continuous-BlPu"
                }
              }
            ]
          }
        ]
      },
      "gridPos": {
        "h": 8,
        "w": 7,
        "x": 6,
        "y": 1
      },
      "id": 20,
      "options": {
        "cellHeight": "sm",
        "footer": {
          "countRows": false,
          "enablePagination": false,
          "fields": "",
          "reducer": [
            "sum"
          ],
          "show": false
        },
        "showHeader": true
      },
      "pluginVersion": "11.6.0",
      "targets": [
        {
          "datasource": {
            "type": "questdb-questdb-datasource",
            "uid": "${DS_QDB}"
          },
          "editorMode": "code",
          "format": 1,
          "rawQuery": true,
          "rawSql": "SELECT timestamp as Time, sum(asks[1,1]-bids[1,1]) as Spread, sum(bids[1,1]*bids[2,1]) as Bid_Volume, sum(asks[1,1]*asks[2,1]) as Ask_Volume\nfrom market_data\nWHERE \n$__timeFilter(timestamp) and symbol = '${SYMBOL}'\nSAMPLE BY 1s\norder by timestamp desc \nlimit 6",
          "refId": "A",
          "selectedFormat": 2,
          "sql": {
            "columns": [
              {
                "parameters": [],
                "type": "function"
              }
            ],
            "groupBy": [
              {
                "property": {
                  "type": "string"
                },
                "type": "groupBy"
              }
            ],
            "limit": 50
          }
        }
      ],
      "timeFrom": "1m",
      "title": "Spread and Volume per second - ${SYMBOL} ",
      "transparent": true,
      "type": "table"
    },
    {
      "datasource": {
        "type": "questdb-questdb-datasource",
        "uid": "${DS_QDB}"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "fixedColor": "light-blue",
            "mode": "shades"
          },
          "custom": {
            "align": "auto",
            "cellOptions": {
              "type": "color-background"
            },
            "inspect": false,
            "minWidth": 50,
            "width": 99
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green"
              },
              {
                "color": "red",
                "value": 80
              }
            ]
          }
        },
        "overrides": [
          {
            "matcher": {
              "id": "byName",
              "options": "MarketData_Time"
            },
            "properties": [
              {
                "id": "custom.minWidth",
                "value": 200
              },
              {
                "id": "custom.width",
                "value": 180
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "CorePrice_Time"
            },
            "properties": [
              {
                "id": "custom.minWidth",
                "value": 200
              },
              {
                "id": "custom.width",
                "value": 180
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "Level"
            },
            "properties": [
              {
                "id": "custom.width",
                "value": 55
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "Price"
            },
            "properties": [
              {
                "id": "custom.width",
                "value": 60
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "Bid_Price"
            },
            "properties": [
              {
                "id": "custom.width",
                "value": 80
              }
            ]
          }
        ]
      },
      "gridPos": {
        "h": 8,
        "w": 11,
        "x": 13,
        "y": 1
      },
      "id": 19,
      "options": {
        "cellHeight": "sm",
        "footer": {
          "countRows": false,
          "fields": "",
          "reducer": [
            "sum"
          ],
          "show": false
        },
        "showHeader": true
      },
      "pluginVersion": "11.6.0",
      "targets": [
        {
          "format": 1,
          "meta": {
            "builderOptions": {
              "fields": [],
              "limit": "",
              "mode": "list",
              "timeField": ""
            }
          },
          "queryType": "sql",
          "rawSql": "with p as (select timestamp, bid_price, bid_volume, symbol, ecn  from core_price where $__timeFilter(timestamp) and symbol = '${SYMBOL}' limit -6), levels as (\n        select market_data.timestamp as md_timestamp, insertion_point(bids[2], bid_volume) as level, bids[1][insertion_point(bids[2], bid_volume)] as price, bids[2][insertion_point(bids[2], bid_volume)] as volume, \n         p.timestamp, p.bid_price, p.bid_volume as bid_volume,p.ecn from p asof join market_data on symbol\n\n         )\n         select md_timestamp as MarketData_Time, case when price is null then null else level end as Level, Price, Volume, timestamp as CorePrice_Time, bid_price as Bid_Price, bid_volume1 as Bid_Volume, ecn as ECN from levels;",
          "refId": "A",
          "selectedFormat": 1,
          "datasource": {
            "type": "questdb-questdb-datasource",
            "uid": "${DS_QDB}"
          }
        }
      ],
      "timeFrom": "1m",
      "title": "Top-of-book Price vs Core Price - ${SYMBOL}",
      "transparent": true,
      "type": "table"
    },
    {
      "collapsed": false,
      "gridPos": {
        "h": 1,
        "w": 24,
        "x": 0,
        "y": 9
      },
      "id": 24,
      "panels": [],
      "title": "OHLC Bars",
      "type": "row"
    },
    {
      "datasource": {
        "type": "questdb-questdb-datasource",
        "uid": "${DS_QDB}"
      },
      "description": "",
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "palette-classic"
          },
          "custom": {
            "axisBorderShow": false,
            "axisCenteredZero": false,
            "axisColorMode": "text",
            "axisLabel": "",
            "axisPlacement": "auto",
            "barAlignment": 0,
            "barWidthFactor": 0.6,
            "drawStyle": "line",
            "fillOpacity": 0,
            "gradientMode": "none",
            "hideFrom": {
              "legend": false,
              "tooltip": false,
              "viz": false
            },
            "insertNulls": false,
            "lineInterpolation": "linear",
            "lineStyle": {
              "fill": "solid"
            },
            "lineWidth": 1,
            "pointSize": 3,
            "scaleDistribution": {
              "type": "linear"
            },
            "showPoints": "auto",
            "spanNulls": false,
            "stacking": {
              "group": "A",
              "mode": "none"
            },
            "thresholdsStyle": {
              "mode": "off"
            }
          },
          "fieldMinMax": false,
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green"
              },
              {
                "color": "red",
                "value": 80
              }
            ]
          }
        },
        "overrides": []
      },
      "gridPos": {
        "h": 7,
        "w": 7,
        "x": 0,
        "y": 10
      },
      "id": 6,
      "options": {
        "candleStyle": "candles",
        "colorStrategy": "close-close",
        "colors": {
          "down": "light-blue",
          "up": "semi-dark-purple"
        },
        "fields": {
          "close": "close",
          "high": "high",
          "low": "low",
          "open": "open",
          "volume": "total_volume"
        },
        "includeAllFields": false,
        "legend": {
          "calcs": [],
          "displayMode": "list",
          "placement": "bottom",
          "showLegend": false
        },
        "mode": "candles",
        "tooltip": {
          "hideZeros": false,
          "mode": "multi",
          "sort": "none"
        }
      },
      "pluginVersion": "11.6.0",
      "targets": [
        {
          "datasource": {
            "type": "questdb-questdb-datasource",
            "uid": "${DS_QDB}"
          },
          "editorMode": "code",
          "format": 0,
          "rawQuery": true,
          "rawSql": "select timestamp, first(open) open, max(high) high, min(low) low, last(close) close, sum(total_volume) total_volume\n        from market_data_ohlc_1m\n        where  $__timeFilter(timestamp) and symbol = '${SYMBOL}'\n        sample by 2m\n        \n        \n",
          "refId": "A",
          "selectedFormat": 0,
          "sql": {
            "columns": [
              {
                "parameters": [],
                "type": "function"
              }
            ],
            "groupBy": [
              {
                "property": {
                  "type": "string"
                },
                "type": "groupBy"
              }
            ],
            "limit": 50
          }
        }
      ],
      "timeFrom": "2h",
      "title": "OHLC - Bids - 1m - (${SYMBOL})",
      "transparent": true,
      "type": "candlestick"
    },
    {
      "datasource": {
        "type": "questdb-questdb-datasource",
        "uid": "${DS_QDB}"
      },
      "description": "",
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "palette-classic"
          },
          "custom": {
            "axisBorderShow": false,
            "axisCenteredZero": false,
            "axisColorMode": "text",
            "axisLabel": "",
            "axisPlacement": "auto",
            "barAlignment": 0,
            "barWidthFactor": 0.6,
            "drawStyle": "line",
            "fillOpacity": 0,
            "gradientMode": "none",
            "hideFrom": {
              "legend": false,
              "tooltip": false,
              "viz": false
            },
            "insertNulls": false,
            "lineInterpolation": "linear",
            "lineStyle": {
              "fill": "solid"
            },
            "lineWidth": 1,
            "pointSize": 3,
            "scaleDistribution": {
              "type": "linear"
            },
            "showPoints": "auto",
            "spanNulls": false,
            "stacking": {
              "group": "A",
              "mode": "none"
            },
            "thresholdsStyle": {
              "mode": "off"
            }
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green"
              },
              {
                "color": "red",
                "value": 80
              }
            ]
          }
        },
        "overrides": []
      },
      "gridPos": {
        "h": 7,
        "w": 10,
        "x": 7,
        "y": 10
      },
      "id": 13,
      "options": {
        "candleStyle": "candles",
        "colorStrategy": "close-close",
        "colors": {
          "down": "light-blue",
          "up": "semi-dark-purple"
        },
        "fields": {
          "close": "close",
          "high": "high",
          "low": "low",
          "open": "open",
          "volume": "total_volume"
        },
        "includeAllFields": false,
        "legend": {
          "calcs": [],
          "displayMode": "list",
          "placement": "bottom",
          "showLegend": false
        },
        "mode": "candles+volume",
        "tooltip": {
          "hideZeros": false,
          "mode": "multi",
          "sort": "none"
        }
      },
      "pluginVersion": "11.6.0",
      "targets": [
        {
          "datasource": {
            "type": "questdb-questdb-datasource",
            "uid": "${DS_QDB}"
          },
          "editorMode": "code",
          "format": 1,
          "rawQuery": true,
          "rawSql": "select timestamp, open, high, low,  close, total_volume\n        from market_data_ohlc_15m\n        where  $__timeFilter(timestamp) and symbol = '${SYMBOL}'\n        \n        \n",
          "refId": "A",
          "selectedFormat": 2,
          "sql": {
            "columns": [
              {
                "parameters": [],
                "type": "function"
              }
            ],
            "groupBy": [
              {
                "property": {
                  "type": "string"
                },
                "type": "groupBy"
              }
            ],
            "limit": 50
          }
        }
      ],
      "timeFrom": "12h",
      "title": "OHLC - Bids - 15m - (${SYMBOL})",
      "transparent": true,
      "type": "candlestick"
    },
    {
      "datasource": {
        "type": "questdb-questdb-datasource",
        "uid": "${DS_QDB}"
      },
      "description": "",
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "palette-classic"
          },
          "custom": {
            "axisBorderShow": false,
            "axisCenteredZero": false,
            "axisColorMode": "text",
            "axisLabel": "",
            "axisPlacement": "auto",
            "barAlignment": 0,
            "barWidthFactor": 0.6,
            "drawStyle": "line",
            "fillOpacity": 0,
            "gradientMode": "none",
            "hideFrom": {
              "legend": false,
              "tooltip": false,
              "viz": false
            },
            "insertNulls": false,
            "lineInterpolation": "linear",
            "lineStyle": {
              "fill": "solid"
            },
            "lineWidth": 1,
            "pointSize": 3,
            "scaleDistribution": {
              "type": "linear"
            },
            "showPoints": "auto",
            "spanNulls": false,
            "stacking": {
              "group": "A",
              "mode": "none"
            },
            "thresholdsStyle": {
              "mode": "off"
            }
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green"
              },
              {
                "color": "red",
                "value": 80
              }
            ]
          }
        },
        "overrides": []
      },
      "gridPos": {
        "h": 7,
        "w": 7,
        "x": 17,
        "y": 10
      },
      "id": 14,
      "options": {
        "candleStyle": "candles",
        "colorStrategy": "close-close",
        "colors": {
          "down": "light-blue",
          "up": "semi-dark-purple"
        },
        "fields": {
          "close": "close",
          "high": "high",
          "low": "low",
          "open": "open",
          "volume": "total_volume"
        },
        "includeAllFields": false,
        "legend": {
          "calcs": [],
          "displayMode": "list",
          "placement": "bottom",
          "showLegend": false
        },
        "mode": "candles+volume",
        "tooltip": {
          "hideZeros": false,
          "mode": "multi",
          "sort": "none"
        }
      },
      "pluginVersion": "11.6.0",
      "targets": [
        {
          "datasource": {
            "type": "questdb-questdb-datasource",
            "uid": "${DS_QDB}"
          },
          "editorMode": "code",
          "format": 1,
          "rawQuery": true,
          "rawSql": "select timestamp, open, high, low,  close, total_volume\n        from market_data_ohlc_1d\n        where  $__timeFilter(timestamp) and symbol = '${SYMBOL}'\n        \n        \n",
          "refId": "A",
          "selectedFormat": 2,
          "sql": {
            "columns": [
              {
                "parameters": [],
                "type": "function"
              }
            ],
            "groupBy": [
              {
                "property": {
                  "type": "string"
                },
                "type": "groupBy"
              }
            ],
            "limit": 50
          }
        }
      ],
      "timeFrom": "7d",
      "title": "OHLC - Bids - 1d - (${SYMBOL})",
      "transparent": true,
      "type": "candlestick"
    },
    {
      "collapsed": false,
      "gridPos": {
        "h": 1,
        "w": 24,
        "x": 0,
        "y": 17
      },
      "id": 23,
      "panels": [],
      "title": "VWAP",
      "type": "row"
    },
    {
      "datasource": {
        "type": "questdb-questdb-datasource",
        "uid": "${DS_QDB}"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "palette-classic"
          },
          "custom": {
            "axisBorderShow": false,
            "axisCenteredZero": false,
            "axisColorMode": "text",
            "axisLabel": "",
            "axisPlacement": "auto",
            "barAlignment": 0,
            "barWidthFactor": 0.6,
            "drawStyle": "line",
            "fillOpacity": 0,
            "gradientMode": "none",
            "hideFrom": {
              "legend": false,
              "tooltip": false,
              "viz": false
            },
            "insertNulls": false,
            "lineInterpolation": "linear",
            "lineWidth": 1,
            "pointSize": 5,
            "scaleDistribution": {
              "type": "linear"
            },
            "showPoints": "auto",
            "spanNulls": false,
            "stacking": {
              "group": "A",
              "mode": "none"
            },
            "thresholdsStyle": {
              "mode": "off"
            }
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green"
              },
              {
                "color": "red",
                "value": 80
              }
            ]
          }
        },
        "overrides": []
      },
      "gridPos": {
        "h": 7,
        "w": 12,
        "x": 0,
        "y": 18
      },
      "hideTimeOverride": false,
      "id": 11,
      "options": {
        "candleStyle": "candles",
        "colorStrategy": "open-close",
        "colors": {
          "down": "light-blue",
          "up": "semi-dark-purple"
        },
        "fields": {
          "close": "close",
          "high": "high",
          "low": "low",
          "open": "open",
          "volume": "total_volume"
        },
        "includeAllFields": true,
        "legend": {
          "calcs": [],
          "displayMode": "list",
          "placement": "bottom",
          "showLegend": true
        },
        "mode": "candles+volume",
        "tooltip": {
          "hideZeros": false,
          "mode": "multi",
          "sort": "none"
        }
      },
      "pluginVersion": "11.6.0",
      "targets": [
        {
          "datasource": {
            "type": "questdb-questdb-datasource",
            "uid": "${DS_QDB}"
          },
          "format": 1,
          "meta": {
            "builderOptions": {
              "fields": [],
              "limit": "",
              "mode": "list",
              "timeField": ""
            }
          },
          "queryType": "sql",
          "rawSql": "\nWITH sampled AS (\n    SELECT\n          timestamp,  symbol,\n          total_volume,\n          ((open+close)/2) * total_volume AS traded_value\n     FROM market_data_ohlc_1m\n     WHERE $__timeFilter(timestamp)\n      AND \n      symbol IN '${SYMBOL}'     \n), cumulative AS (\n     SELECT timestamp, symbol,\n           SUM(traded_value)\n                OVER (ORDER BY timestamp) AS cumulative_value,\n           SUM(total_volume)\n                OVER (ORDER BY timestamp) AS cumulative_volume\n     FROM sampled\n), vwap as (\nSELECT timestamp, cumulative_value/cumulative_volume AS vwap FROM cumulative\n), ohlc AS (\n     select timestamp, open, high, low,  close, total_volume\n        from market_data_ohlc_1m\n        where  $__timeFilter(timestamp) and symbol = '${SYMBOL}'\n)        \nselect * from vwap asof join ohlc        \n",
          "refId": "A",
          "selectedFormat": 2
        }
      ],
      "timeFrom": "now/d",
      "title": "VWAP today - 1m intervals - (${SYMBOL})",
      "type": "candlestick"
    },
    {
      "datasource": {
        "type": "questdb-questdb-datasource",
        "uid": "${DS_QDB}"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "palette-classic"
          },
          "custom": {
            "axisBorderShow": false,
            "axisCenteredZero": false,
            "axisColorMode": "text",
            "axisLabel": "",
            "axisPlacement": "auto",
            "barAlignment": 0,
            "barWidthFactor": 0.6,
            "drawStyle": "line",
            "fillOpacity": 0,
            "gradientMode": "none",
            "hideFrom": {
              "legend": false,
              "tooltip": false,
              "viz": false
            },
            "insertNulls": false,
            "lineInterpolation": "linear",
            "lineWidth": 1,
            "pointSize": 5,
            "scaleDistribution": {
              "type": "linear"
            },
            "showPoints": "auto",
            "spanNulls": false,
            "stacking": {
              "group": "A",
              "mode": "none"
            },
            "thresholdsStyle": {
              "mode": "off"
            }
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green"
              },
              {
                "color": "red",
                "value": 80
              }
            ]
          }
        },
        "overrides": []
      },
      "gridPos": {
        "h": 7,
        "w": 12,
        "x": 12,
        "y": 18
      },
      "hideTimeOverride": false,
      "id": 17,
      "options": {
        "candleStyle": "candles",
        "colorStrategy": "open-close",
        "colors": {
          "down": "light-blue",
          "up": "semi-dark-purple"
        },
        "fields": {
          "close": "close",
          "high": "high",
          "low": "low",
          "open": "open",
          "volume": "total_volume"
        },
        "includeAllFields": true,
        "legend": {
          "calcs": [],
          "displayMode": "list",
          "placement": "bottom",
          "showLegend": true
        },
        "mode": "candles+volume",
        "tooltip": {
          "hideZeros": false,
          "mode": "multi",
          "sort": "none"
        }
      },
      "pluginVersion": "11.6.0",
      "targets": [
        {
          "datasource": {
            "type": "questdb-questdb-datasource",
            "uid": "${DS_QDB}"
          },
          "format": 1,
          "meta": {
            "builderOptions": {
              "fields": [],
              "limit": "",
              "mode": "list",
              "timeField": ""
            }
          },
          "queryType": "sql",
          "rawSql": "\nWITH sampled AS (\n    SELECT\n          timestamp,  symbol,\n          total_volume,\n          ((open+close)/2) * total_volume AS traded_value\n     FROM market_data_ohlc_15m\n     WHERE $__timeFilter(timestamp)\n      AND \n      symbol IN '${SYMBOL}'     \n), cumulative AS (\n     SELECT timestamp, symbol,\n           SUM(traded_value)\n                OVER (ORDER BY timestamp) AS cumulative_value,\n           SUM(total_volume)\n                OVER (ORDER BY timestamp) AS cumulative_volume\n     FROM sampled\n), vwap AS (\nSELECT timestamp, cumulative_value/cumulative_volume AS vwap FROM cumulative\n), ohlc AS (\nselect timestamp, open, high, low,  close, total_volume\n        from market_data_ohlc_15m\n        where  $__timeFilter(timestamp) and symbol = '${SYMBOL}'\n)\nselect * from vwap asof join ohlc        \n        \n",
          "refId": "A",
          "selectedFormat": 2
        }
      ],
      "timeFrom": "now-1d/d",
      "title": "VWAP yesterday - 15m intervals - (${SYMBOL})",
      "type": "candlestick"
    },
    {
      "collapsed": false,
      "gridPos": {
        "h": 1,
        "w": 24,
        "x": 0,
        "y": 25
      },
      "id": 22,
      "panels": [],
      "title": "Other Indicators",
      "type": "row"
    },
    {
      "datasource": {
        "type": "questdb-questdb-datasource",
        "uid": "${DS_QDB}"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "palette-classic"
          },
          "custom": {
            "axisBorderShow": false,
            "axisCenteredZero": false,
            "axisColorMode": "text",
            "axisLabel": "",
            "axisPlacement": "auto",
            "barAlignment": 0,
            "barWidthFactor": 0.6,
            "drawStyle": "line",
            "fillOpacity": 0,
            "gradientMode": "none",
            "hideFrom": {
              "legend": false,
              "tooltip": false,
              "viz": false
            },
            "insertNulls": false,
            "lineInterpolation": "linear",
            "lineWidth": 1,
            "pointSize": 5,
            "scaleDistribution": {
              "type": "linear"
            },
            "showPoints": "auto",
            "spanNulls": false,
            "stacking": {
              "group": "A",
              "mode": "none"
            },
            "thresholdsStyle": {
              "mode": "off"
            }
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green"
              },
              {
                "color": "red",
                "value": 80
              }
            ]
          }
        },
        "overrides": [
          {
            "matcher": {
              "id": "byName",
              "options": "Bid"
            },
            "properties": [
              {
                "id": "color",
                "value": {
                  "fixedColor": "semi-dark-purple",
                  "mode": "fixed"
                }
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "RSI_12h"
            },
            "properties": [
              {
                "id": "color",
                "value": {
                  "fixedColor": "light-blue",
                  "mode": "fixed"
                }
              }
            ]
          }
        ]
      },
      "gridPos": {
        "h": 8,
        "w": 12,
        "x": 0,
        "y": 26
      },
      "hideTimeOverride": false,
      "id": 16,
      "options": {
        "legend": {
          "calcs": [],
          "displayMode": "list",
          "placement": "bottom",
          "showLegend": true
        },
        "tooltip": {
          "hideZeros": false,
          "mode": "multi",
          "sort": "none"
        }
      },
      "pluginVersion": "11.6.0",
      "targets": [
        {
          "format": 0,
          "meta": {
            "builderOptions": {
              "fields": [],
              "limit": "",
              "mode": "list",
              "timeField": ""
            }
          },
          "queryType": "sql",
          "rawSql": "WITH price_changes AS (\n    SELECT\n        timestamp,    \n        symbol,    \n        bid,\n        bid - prev_bid price_change\n    FROM (    \n      SELECT \n          timestamp,\n          symbol,\n          bid,\n          LAG(bid) OVER (PARTITION BY symbol ORDER BY timestamp) AS prev_bid\n      FROM bbo_1h\n      WHERE  $__timeFilter(timestamp)\n      AND symbol = '${SYMBOL}'\n    )  \n),\ngains_losses AS (\n    SELECT \n        timestamp,\n        symbol,\n        bid,\n        CASE WHEN price_change > 0 THEN price_change ELSE 0 END AS gain,\n        CASE WHEN price_change < 0 THEN ABS(price_change) ELSE 0 END AS loss\n    FROM price_changes\n),\n\navg_gains_losses AS (\n    SELECT \n        timestamp,\n        symbol,\n        bid,\n        AVG(gain) OVER (PARTITION BY symbol ORDER BY timestamp ROWS BETWEEN 11 PRECEDING AND CURRENT ROW) AS avg_gain,\n        AVG(loss) OVER (PARTITION BY symbol ORDER BY timestamp ROWS BETWEEN 11 PRECEDING AND CURRENT ROW) AS avg_loss\n    FROM gains_losses\n)\n\nSELECT \n    timestamp,    \n    Bid,\n    CASE \n        WHEN avg_loss = 0 THEN 100\n        ELSE 100 - (100 / (1 + (avg_gain / NULLIF(avg_loss, 0))))\n    END AS RSI_12h\nFROM avg_gains_losses\nORDER BY timestamp;\n",
          "refId": "A",
          "selectedFormat": 0,
          "datasource": {
            "type": "questdb-questdb-datasource",
            "uid": "${DS_QDB}"
          }
        }
      ],
      "timeFrom": "now-24h",
      "title": "Relative Strenght Index - 12h - (${SYMBOL})",
      "type": "timeseries"
    },
    {
      "datasource": {
        "type": "questdb-questdb-datasource",
        "uid": "${DS_QDB}"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "palette-classic"
          },
          "custom": {
            "axisBorderShow": false,
            "axisCenteredZero": false,
            "axisColorMode": "text",
            "axisLabel": "",
            "axisPlacement": "auto",
            "barAlignment": 0,
            "barWidthFactor": 0.6,
            "drawStyle": "line",
            "fillOpacity": 0,
            "gradientMode": "none",
            "hideFrom": {
              "legend": false,
              "tooltip": false,
              "viz": false
            },
            "insertNulls": false,
            "lineInterpolation": "linear",
            "lineWidth": 1,
            "pointSize": 5,
            "scaleDistribution": {
              "type": "linear"
            },
            "showPoints": "auto",
            "spanNulls": false,
            "stacking": {
              "group": "A",
              "mode": "none"
            },
            "thresholdsStyle": {
              "mode": "off"
            }
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green"
              },
              {
                "color": "red",
                "value": 80
              }
            ]
          }
        },
        "overrides": []
      },
      "gridPos": {
        "h": 8,
        "w": 12,
        "x": 12,
        "y": 26
      },
      "id": 26,
      "options": {
        "candleStyle": "candles",
        "colorStrategy": "open-close",
        "colors": {
          "down": "light-blue",
          "up": "semi-dark-purple"
        },
        "fields": {
          "close": "close",
          "high": "high",
          "low": "low",
          "open": "open",
          "volume": "total_volume"
        },
        "includeAllFields": true,
        "legend": {
          "calcs": [],
          "displayMode": "list",
          "placement": "bottom",
          "showLegend": true
        },
        "mode": "candles+volume",
        "tooltip": {
          "hideZeros": false,
          "mode": "multi",
          "sort": "none"
        }
      },
      "pluginVersion": "11.6.0",
      "targets": [
        {
          "format": 0,
          "meta": {
            "builderOptions": {
              "fields": [],
              "limit": "",
              "mode": "list",
              "timeField": ""
            }
          },
          "queryType": "sql",
          "rawSql": "WITH stats AS (\n  SELECT\n    timestamp,\n    close,\n    AVG(close) OVER (\n      ORDER BY timestamp\n      ROWS BETWEEN 19 PRECEDING AND CURRENT ROW\n    ) AS sma20,\n    AVG(close * close ) OVER (\n      ORDER BY timestamp\n      ROWS BETWEEN 19 PRECEDING AND CURRENT ROW \n    ) AS avg_close_sq\n  FROM market_data_ohlc_15m -- 20 periods of 15 minutes = SMA 6h\n   WHERE  $__timeFilter(timestamp)\n      AND symbol IN '${SYMBOL}'\n), bollinger AS (\nSELECT\n  timestamp,\n  sma20,\n  -- sqrt(avg_close_sq - (sma20 * sma20)) as stdev20,\n  sma20 + 2 * sqrt(avg_close_sq - (sma20 * sma20)) as upper_band,\n  sma20 - 2 * sqrt(avg_close_sq - (sma20 * sma20)) as lower_band\nFROM stats\nORDER BY timestamp ),\nohlc as (\n  select timestamp, open, high, low,  close, total_volume\n        from market_data_ohlc_15m\n        where  $__timeFilter(timestamp) and symbol = '${SYMBOL}'\n)\nselect * from bollinger asof join ohlc",
          "refId": "A",
          "selectedFormat": 0,
          "datasource": {
            "type": "questdb-questdb-datasource",
            "uid": "${DS_QDB}"
          }
        }
      ],
      "timeFrom": "now-15h",
      "title": "Bollinger Bands (20, 2) – 15m OHLC (6h Window) - (${SYMBOL})",
      "type": "candlestick"
    },
    {
      "collapsed": false,
      "gridPos": {
        "h": 1,
        "w": 24,
        "x": 0,
        "y": 34
      },
      "id": 25,
      "panels": [],
      "title": "Bids / Asks",
      "type": "row"
    },
    {
      "datasource": {
        "type": "questdb-questdb-datasource",
        "uid": "${DS_QDB}"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "palette-classic"
          },
          "custom": {
            "axisBorderShow": false,
            "axisCenteredZero": false,
            "axisColorMode": "text",
            "axisLabel": "",
            "axisPlacement": "auto",
            "barAlignment": 0,
            "barWidthFactor": 0.6,
            "drawStyle": "line",
            "fillOpacity": 0,
            "gradientMode": "none",
            "hideFrom": {
              "legend": false,
              "tooltip": false,
              "viz": false
            },
            "insertNulls": false,
            "lineInterpolation": "linear",
            "lineWidth": 1,
            "pointSize": 5,
            "scaleDistribution": {
              "type": "linear"
            },
            "showPoints": "auto",
            "spanNulls": false,
            "stacking": {
              "group": "A",
              "mode": "none"
            },
            "thresholdsStyle": {
              "mode": "off"
            }
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green"
              },
              {
                "color": "red",
                "value": 80
              }
            ]
          }
        },
        "overrides": [
          {
            "matcher": {
              "id": "byName",
              "options": "bid"
            },
            "properties": [
              {
                "id": "color",
                "value": {
                  "fixedColor": "semi-dark-purple",
                  "mode": "fixed"
                }
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "ask"
            },
            "properties": [
              {
                "id": "color",
                "value": {
                  "fixedColor": "light-blue",
                  "mode": "fixed"
                }
              }
            ]
          }
        ]
      },
      "gridPos": {
        "h": 8,
        "w": 12,
        "x": 0,
        "y": 35
      },
      "id": 18,
      "options": {
        "legend": {
          "calcs": [],
          "displayMode": "list",
          "placement": "bottom",
          "showLegend": true
        },
        "tooltip": {
          "hideZeros": false,
          "mode": "multi",
          "sort": "none"
        }
      },
      "pluginVersion": "11.6.0",
      "targets": [
        {
          "format": 1,
          "meta": {
            "builderOptions": {
              "fields": [],
              "limit": "",
              "mode": "list",
              "timeField": ""
            }
          },
          "queryType": "sql",
          "rawSql": "\nSELECT timestamp time, symbol, sum(bids[1,1] * bids[2,1]) as bid, -1 * sum(asks[1,1] * asks[2,1]) as ask\n  from market_data where $__timeFilter(timestamp) and \nsymbol IN '${SYMBOL}'\nsample by 30s;\n\n\n",
          "refId": "A",
          "selectedFormat": 2,
          "datasource": {
            "type": "questdb-questdb-datasource",
            "uid": "${DS_QDB}"
          }
        }
      ],
      "timeFrom": "30m",
      "title": "Bid vs Ask Volume -  30s - (${SYMBOL})",
      "type": "timeseries"
    },
    {
      "datasource": {
        "type": "questdb-questdb-datasource",
        "uid": "${DS_QDB}"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "palette-classic"
          },
          "custom": {
            "axisBorderShow": false,
            "axisCenteredZero": false,
            "axisColorMode": "text",
            "axisLabel": "",
            "axisPlacement": "auto",
            "barAlignment": 0,
            "barWidthFactor": 0.6,
            "drawStyle": "line",
            "fillOpacity": 0,
            "gradientMode": "none",
            "hideFrom": {
              "legend": false,
              "tooltip": false,
              "viz": false
            },
            "insertNulls": false,
            "lineInterpolation": "linear",
            "lineWidth": 1,
            "pointSize": 5,
            "scaleDistribution": {
              "type": "linear"
            },
            "showPoints": "auto",
            "spanNulls": false,
            "stacking": {
              "group": "A",
              "mode": "none"
            },
            "thresholdsStyle": {
              "mode": "off"
            }
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green"
              },
              {
                "color": "red",
                "value": 80
              }
            ]
          }
        },
        "overrides": [
          {
            "matcher": {
              "id": "byName",
              "options": "Ask"
            },
            "properties": [
              {
                "id": "color",
                "value": {
                  "fixedColor": "light-blue",
                  "mode": "fixed"
                }
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "Mid"
            },
            "properties": [
              {
                "id": "color",
                "value": {
                  "fixedColor": "semi-dark-green",
                  "mode": "fixed"
                }
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "Bid"
            },
            "properties": [
              {
                "id": "color",
                "value": {
                  "fixedColor": "semi-dark-purple",
                  "mode": "fixed"
                }
              }
            ]
          }
        ]
      },
      "gridPos": {
        "h": 8,
        "w": 12,
        "x": 12,
        "y": 35
      },
      "id": 12,
      "options": {
        "legend": {
          "calcs": [],
          "displayMode": "list",
          "placement": "bottom",
          "showLegend": true
        },
        "tooltip": {
          "hideZeros": false,
          "mode": "multi",
          "sort": "none"
        }
      },
      "pluginVersion": "11.6.0",
      "targets": [
        {
          "builderOptions": {
            "0": "T",
            "1": "h",
            "2": "e",
            "3": " ",
            "4": "q",
            "5": "u",
            "6": "e",
            "7": "r",
            "8": "y",
            "9": " ",
            "10": "c",
            "11": "a",
            "12": "n",
            "13": "'",
            "14": "t",
            "15": " ",
            "16": "b",
            "17": "e",
            "18": " ",
            "19": "p",
            "20": "a",
            "21": "r",
            "22": "s",
            "23": "e",
            "24": "d",
            "25": ".",
            "fields": [],
            "filters": [],
            "groupBy": [],
            "limit": "",
            "metrics": [
              {
                "aggregation": "avg",
                "alias": "mid_bbo",
                "field": "bid"
              }
            ],
            "mode": "trend",
            "orderBy": [],
            "partitionBy": [],
            "sampleByAlignTo": "CALENDAR",
            "table": "bbo_1s",
            "timeField": "timestamp"
          },
          "format": 0,
          "meta": {
            "builderOptions": {
              "0": "T",
              "1": "h",
              "2": "e",
              "3": " ",
              "4": "q",
              "5": "u",
              "6": "e",
              "7": "r",
              "8": "y",
              "9": " ",
              "10": "c",
              "11": "a",
              "12": "n",
              "13": "'",
              "14": "t",
              "15": " ",
              "16": "b",
              "17": "e",
              "18": " ",
              "19": "p",
              "20": "a",
              "21": "r",
              "22": "s",
              "23": "e",
              "24": "d",
              "25": ".",
              "fields": [],
              "filters": [],
              "groupBy": [],
              "limit": "",
              "metrics": [
                {
                  "aggregation": "avg",
                  "alias": "mid_bbo",
                  "field": "bid"
                }
              ],
              "mode": "trend",
              "orderBy": [],
              "partitionBy": [],
              "sampleByAlignTo": "CALENDAR",
              "table": "bbo_1s",
              "timeField": "timestamp"
            }
          },
          "queryType": "sql",
          "rawSql": "--SELECT timestamp as time,  symbol,\n--avg(bid) best_bid,\n--avg(ask) best_ask,\n--avg((bid+ask)/2) best_mid,\n-- FROM \"bbo_1s\" \n--WHERE $__timeFilter(timestamp)\n--and symbol IN '${SYMBOL}'\n--SAMPLE BY $__sampleByInterval\n\nSELECT timestamp as Time,  Symbol, Bid, Ask, (bid+ask)/2 as Mid\n FROM \"bbo_1s\" \nWHERE $__timeFilter(timestamp)\nand symbol IN '${SYMBOL}'\n",
          "refId": "A",
          "selectedFormat": 2,
          "datasource": {
            "type": "questdb-questdb-datasource",
            "uid": "${DS_QDB}"
          }
        }
      ],
      "timeFrom": "2h",
      "title": "Best Bid and Offer - 1s - (${SYMBOL})",
      "type": "timeseries"
    }
  ],
  "refresh": "750ms",
  "schemaVersion": 41,
  "tags": [],
  "templating": {
    "list": [
      {
        "allowCustomValue": false,
        "current": {},
        "datasource": {
          "type": "questdb-questdb-datasource",
          "uid": "${DS_QDB}"
        },
        "definition": "SELECT distinct SYMBOL FROM (\nSELECT  SYMBOL FROM core_price\nwhere timestamp > dateadd('d',-4,now())\nlatest on timestamp partition by symbol\n) order by symbol;\n",
        "description": "symbol to filter by",
        "hide": 1,
        "includeAll": false,
        "label": "symbol",
        "name": "SYMBOL",
        "options": [],
        "query": "SELECT distinct SYMBOL FROM (\nSELECT  SYMBOL FROM core_price\nwhere timestamp > dateadd('d',-4,now())\nlatest on timestamp partition by symbol\n) order by symbol;\n",
        "refresh": 1,
        "regex": "",
        "type": "query"
      }
    ]
  },
  "time": {
    "from": "now-1h",
    "to": "now"
  },
  "timepicker": {
    "refresh_intervals": [
      "250ms",
      "500ms",
      "750ms",
      "1s",
      "2s",
      "5s",
      "10s",
      "30s",
      "1m",
      "5m",
      "15m",
      "30m",
      "1h",
      "2h",
      "1d"
    ]
  },
  "timezone": "browser",
  "title": "FX Orderbook Demo",
  "uid": "beqtshx9hciyod",
  "version": 41,
  "weekStart": ""
}
